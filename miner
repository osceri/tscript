shell.run("wget https://github.com/osceri/tscript/raw/main/t5")
shell.run("wget https://github.com/osceri/tscript/raw/main/t8")
require("t5")
require("t8")

local x_work = 3
local y_work = 3
local z_work = 0

function go_work()
  x, y, z = get_location()
  movex(x_work - x)
  movex(y_work - y)
  movex(z_work - z)
end

function work()
  turtle.digDown()
  if movez(-1) then
    z_work = z_work - 1
  end
end

function go_home()
  x, y, z = get_location()
  movez(z - z_work)
  movey(y - y_work)
  movex(x - x_work)
end

function repl_count_func()
  return turtle.getFuelLevel()
end

function repl_action_func()
  return turtle.refuel(1)
end

function coal_count_func()
  turtle.select(1)
  return turtle.getItemCount()
end

function coal_action_func()
  go_home()
  set_orientation(1)
  return turtle.suck(4)
end

function inventory_count_func()
  local slot = 0
  for i = 2,16 do
    turtle.select(i)
    if turtle.getItemCount() < 1 then
      slot = slot + 1
    end
  end
  return 15 - slot
end

function inventory_action_func()
  go_home()
  set_orientation(2)
  return turtle.drop(4)
end

local inv_good = false
local coal_good = false
local fuel_good = false

go_work()

while true do
  if inv_good and coal_good and fuel_good then
    work()
  else
    inv_good = vibe_check(inventory_count_func, inventory_action_func, 2, 13)
    coal_good = vibe_check(coal_count_func, coal_action_func, 8, 16)
    fuel_good = vibe_check(repl_count_func, repl_action_func, 4000, 8000)
  end
end

